<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>{{ title }}</title>
  <link rel="stylesheet" href="/static/app.css"/>
</head>
<body>
  <div class="app">
    <!-- Navigation -->
    <div class="nav">
      <div class="nav-inner">
        <div></div>
        <div class="nav-center">üëî Boss Dashboard</div>
        <a href="/admin/logout" style="color:var(--text); text-decoration:none; font-size:14px; opacity:.8;">Logout</a>
      </div>
    </div>

    <div class="screen">
      <div class="largetitle">üìä Quote Approvals</div>
      <p class="subtitle">Review and approve customer quotes</p>

      <!-- Awaiting Approval -->
      <div class="group">
        <div class="rowhead">
          <div class="rowtitle">‚è≥ Awaiting Approval</div>
          <div class="rowsub">{{ awaiting_jobs|length }}</div>
        </div>

        {% if awaiting_jobs|length > 0 %}
          <div class="invlist">
            {% for job in awaiting_jobs %}
              <a class="invlink" href="/admin/job/{{ job.token }}" style="border-color:rgba(255,165,0,.3); background:rgba(255,165,0,.05);">
                <div class="invtop">
                  <div class="invroom">
                    üÜï Job #{{ job.token[:8] }}
                  </div>
                  <div class="invmeta" style="color:#ffa500; font-weight:700;">Pending</div>
                </div>
                <div class="invitems">
                  <strong>¬£{{ "%.0f"|format(job.get('total_cbm', 0) * 35 + 250) }}</strong>
                  ‚Ä¢ {{ job.get('total_cbm', 0) }} m¬≥
                  ‚Ä¢ {{ job.get('total_weight_kg', 0) }} kg
                  {% if job.pickup and job.dropoff %}
                    <br>
                    <span style="font-size:12px;">üìç {{ job.pickup.label[:30] }}... ‚Üí {{ job.dropoff.label[:30] }}...</span>
                  {% endif %}
                </div>
              </a>
            {% endfor %}
          </div>
        {% else %}
          <div class="empty" style="margin-top:12px;">
            <div class="empty-title">All caught up! ‚úÖ</div>
            <div class="empty-sub">No quotes waiting for approval</div>
          </div>
        {% endif %}
      </div>

      <!-- Recently Approved -->
      {% if approved_jobs|length > 0 %}
        <div class="group">
          <div class="rowhead">
            <div class="rowtitle">‚úÖ Recently Approved</div>
            <div class="rowsub">{{ approved_jobs|length }}</div>
          </div>

          <div class="invlist">
            {% for job in approved_jobs %}
              <a class="invlink" href="/admin/job/{{ job.token }}" style="border-color:rgba(46,229,157,.3); background:rgba(46,229,157,.05);">
                <div class="invtop">
                  <div class="invroom">
                    ‚úì Job #{{ job.token[:8] }}
                  </div>
                  <div class="invmeta" style="color:#2ee59d; font-weight:700;">Approved</div>
                </div>
                <div class="invitems">
                  <strong>¬£{{ "%.0f"|format(job.get('total_cbm', 0) * 35 + 250) }}</strong>
                  ‚Ä¢ {{ job.get('total_cbm', 0) }} m¬≥
                  ‚Ä¢ {{ job.get('total_weight_kg', 0) }} kg
                </div>
              </a>
            {% endfor %}
          </div>
        </div>
      {% endif %}

      <!-- Recently Rejected -->
      {% if rejected_jobs|length > 0 %}
        <div class="group">
          <div class="rowhead">
            <div class="rowtitle">‚ùå Recently Rejected</div>
            <div class="rowsub">{{ rejected_jobs|length }}</div>
          </div>

          <div class="invlist">
            {% for job in rejected_jobs %}
              <a class="invlink" href="/admin/job/{{ job.token }}" style="border-color:rgba(255,77,79,.3); background:rgba(255,77,79,.05);">
                <div class="invtop">
                  <div class="invroom">
                    ‚úó Job #{{ job.token[:8] }}
                  </div>
                  <div class="invmeta" style="color:#ff4d4f; font-weight:700;">Rejected</div>
                </div>
                <div class="invitems">
                  {% if job.get('rejection_reason') %}
                    Reason: {{ job.rejection_reason }}
                  {% else %}
                    No reason provided
                  {% endif %}
                </div>
              </a>
            {% endfor %}
          </div>
        </div>
      {% endif %}

      <!-- Stats Summary -->
      <div class="group">
        <div style="font-weight:700; margin-bottom:12px;">üìà Summary</div>
        <div style="display:flex; flex-direction:column; gap:8px;">
          <div class="statrow">
            <div class="staticon" style="background:rgba(255,165,0,.15);">‚è≥</div>
            <div class="statrow-text">
              <span class="statrow-label">Awaiting approval</span>
              <span class="statrow-value">{{ awaiting_jobs|length }}</span>
            </div>
          </div>
          <div class="statrow">
            <div class="staticon" style="background:rgba(46,229,157,.15);">‚úÖ</div>
            <div class="statrow-text">
              <span class="statrow-label">Approved today</span>
              <span class="statrow-value">{{ approved_jobs|length }}</span>
            </div>
          </div>
          <div class="statrow">
            <div class="staticon" style="background:rgba(255,77,79,.15);">‚ùå</div>
            <div class="statrow-text">
              <span class="statrow-label">Rejected today</span>
              <span class="statrow-value">{{ rejected_jobs|length }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Auto-refresh every 30 seconds
    setTimeout(function() {
      location.reload();
    }, 30000);
  </script>
</body>
</html>
