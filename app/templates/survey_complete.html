{% extends "base.html" %}

{% block content %}
  <!-- Voice guidance for this page -->
  <div id="voiceGuidance" data-message="That's your survey done! We've got a full inventory of everything you need moved. You can close this page now, or scroll down to review the summary." hidden></div>

  <div style="text-align:center; padding:40px 0 20px;">
    <div style="font-size:80px; margin-bottom:16px;">&#10003;</div>
    <div class="largetitle">Survey complete</div>
    <p class="subtitle">Your inventory has been recorded.</p>
  </div>

  <!-- Inventory Stats -->
  <div class="group">
    <div style="font-weight:700; margin-bottom:12px;">Inventory summary</div>
    <div style="display:flex; flex-direction:column; gap:8px;">
      <div class="statrow">
        <div class="staticon">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
          </svg>
        </div>
        <div class="statrow-text">
          <span class="statrow-label">Total items</span>
          <span class="statrow-value">{{ total_items }}</span>
        </div>
      </div>
      <div class="statrow">
        <div class="staticon">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="1" y="3" width="15" height="13"></rect>
            <polygon points="16 8 20 8 23 11 23 16 16 16 16 8"></polygon>
          </svg>
        </div>
        <div class="statrow-text">
          <span class="statrow-label">Volume</span>
          <span class="statrow-value">{{ total_cbm }} m&sup3;</span>
        </div>
      </div>
      <div class="statrow">
        <div class="staticon">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="8" x2="12" y2="16"></line>
            <line x1="8" y1="12" x2="16" y2="12"></line>
          </svg>
        </div>
        <div class="statrow-text">
          <span class="statrow-label">Weight</span>
          <span class="statrow-value">{{ total_weight|int }} kg</span>
        </div>
      </div>
      {% if bulky_count > 0 %}
      <div class="statrow">
        <div class="staticon">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
            <path d="M2 17l10 5 10-5"></path>
            <path d="M2 12l10 5 10-5"></path>
          </svg>
        </div>
        <div class="statrow-text">
          <span class="statrow-label">Bulky items</span>
          <span class="statrow-value">{{ bulky_count }}</span>
        </div>
      </div>
      {% endif %}
      {% if fragile_count > 0 %}
      <div class="statrow">
        <div class="staticon">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
          </svg>
        </div>
        <div class="statrow-text">
          <span class="statrow-label">Fragile items</span>
          <span class="statrow-value">{{ fragile_count }}</span>
        </div>
      </div>
      {% endif %}
    </div>
  </div>

  <!-- Room Breakdown -->
  {% if room_stats|length > 0 %}
  <div class="group">
    <div style="font-weight:700; margin-bottom:12px;">Rooms</div>
    <div class="invlist">
      {% for room in room_stats %}
        <div class="invlink" style="cursor:default;">
          <div class="invtop">
            <div class="invroom">{{ room.name }}</div>
            <div class="invmeta">{{ room.item_count }} item{{ 's' if room.item_count != 1 else '' }}</div>
          </div>
        </div>
      {% endfor %}
    </div>
  </div>
  {% endif %}

  <!-- Addresses -->
  {% if job.pickup or job.dropoff %}
  <div class="group">
    <div style="font-weight:700; margin-bottom:12px;">Locations</div>
    {% if job.pickup and job.pickup.label %}
    <div style="margin-bottom:12px;">
      <div style="font-size:12px; color:var(--muted); margin-bottom:4px;">Pickup</div>
      <div style="font-size:14px;">{{ job.pickup.label }}</div>
    </div>
    {% endif %}
    {% if job.dropoff and job.dropoff.label %}
    <div>
      <div style="font-size:12px; color:var(--muted); margin-bottom:4px;">Delivery</div>
      <div style="font-size:14px;">{{ job.dropoff.label }}</div>
    </div>
    {% endif %}
  </div>
  {% endif %}

  <!-- Reference -->
  <div class="group">
    <div style="font-weight:700; margin-bottom:12px;">Reference</div>
    <div style="background:var(--subtle-bg); border-radius:12px; padding:16px; border:1px solid var(--hair); text-align:center;">
      <div style="font-size:11px; color:var(--muted); margin-bottom:8px; text-transform:uppercase; letter-spacing:1px;">Survey Token</div>
      <div style="font-size:24px; font-weight:800; font-family:monospace; letter-spacing:2px;">
        {{ job.token[:8].upper() }}
      </div>
    </div>
  </div>
{% endblock %}

  <!-- Know someone moving? -->
  <div class="group" style="margin-top:24px; border:1px solid rgba(46,229,157,0.15); background:rgba(46,229,157,0.03); border-radius:16px; padding:20px;">
    <div style="font-weight:700; margin-bottom:8px;">Know someone else who's moving?</div>
    <p style="font-size:13px; color:var(--muted); margin-bottom:14px;">Share this free AI-powered tool with friends or family planning a move</p>

    <a href="#" onclick="shareWhatsApp(event)" style="display:flex; align-items:center; justify-content:center; gap:8px; padding:12px; background:#2ee59d; color:#000; border-radius:10px; font-weight:700; font-size:14px; text-decoration:none; margin-bottom:10px;">
      <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20" style="width:20px;height:20px"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347z"/><path d="M12 0C5.373 0 0 5.373 0 12c0 2.625.846 5.059 2.284 7.034L.789 23.492a.5.5 0 00.611.611l4.458-1.495A11.952 11.952 0 0012 24c6.627 0 12-5.373 12-12S18.627 0 12 0zm0 22c-2.357 0-4.542-.804-6.275-2.152l-.44-.352-3.083 1.034 1.034-3.083-.352-.44A9.96 9.96 0 012 12C2 6.486 6.486 2 12 2s10 4.486 10 10-4.486 10-10 10z"/></svg>
      Send to a friend on WhatsApp
    </a>

    <div style="display:flex; gap:8px;">
      <a href="#" onclick="shareFacebook(event)" style="flex:1; text-align:center; padding:8px; background:rgba(255,255,255,0.04); border:1px solid rgba(255,255,255,0.08); border-radius:8px; color:var(--muted); font-size:13px; font-weight:500; text-decoration:none;">Facebook</a>
      <a href="#" onclick="shareX(event)" style="flex:1; text-align:center; padding:8px; background:rgba(255,255,255,0.04); border:1px solid rgba(255,255,255,0.08); border-radius:8px; color:var(--muted); font-size:13px; font-weight:500; text-decoration:none;">X</a>
      <button onclick="copyLink(event)" style="flex:1; text-align:center; padding:8px; background:rgba(255,255,255,0.04); border:1px solid rgba(255,255,255,0.08); border-radius:8px; color:var(--muted); font-size:13px; font-weight:500; cursor:pointer;">Copy Link</button>
    </div>
  </div>
{% endblock %}

{% block footer %}
  <!-- Powered by PrimeHaul -->
  <div class="footer footer-clean">
    <div class="footer-inner">
      <div style="text-align:center; padding:8px 0;">
        <a href="https://primehaul.co.uk?utm_source=survey&utm_medium=badge" target="_blank" style="color:var(--muted); text-decoration:none; font-size:12px; font-weight:500; letter-spacing:0.02em;">
          Powered by <span style="color:#2ee59d; font-weight:700;">PrimeHaul</span> &mdash; AI Removal Quotes
        </a>
      </div>
    </div>
  </div>
{% endblock %}

{% block scripts %}
<script>
(function() {
  var shareLink = 'https://primehaul.co.uk?utm_source=customer_share&utm_medium=social';
  var whatsappMsg = 'Hey! I just did my removal survey in 5 mins using AI - it counted every single item in my rooms from photos. You should try it for your move: ' + shareLink;
  var twitterMsg = 'Just used an AI tool that counted everything in my house from photos for a moving quote. Pretty wild! ' + shareLink;

  window.shareWhatsApp = function(e) {
    e.preventDefault();
    window.open('https://wa.me/?text=' + encodeURIComponent(whatsappMsg), '_blank', 'noopener');
  };
  window.shareFacebook = function(e) {
    e.preventDefault();
    window.open('https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent(shareLink), '_blank', 'width=600,height=400,noopener');
  };
  window.shareX = function(e) {
    e.preventDefault();
    window.open('https://twitter.com/intent/tweet?text=' + encodeURIComponent(twitterMsg), '_blank', 'width=600,height=400,noopener');
  };
  window.copyLink = function(e) {
    e.preventDefault();
    var btn = e.currentTarget;
    navigator.clipboard.writeText(shareLink).then(function() {
      var orig = btn.textContent;
      btn.textContent = 'Copied!';
      btn.style.color = '#2ee59d';
      btn.style.borderColor = 'rgba(46,229,157,0.3)';
      setTimeout(function() { btn.textContent = orig; btn.style.color = ''; btn.style.borderColor = ''; }, 2000);
    });
  };
})();
</script>
{% endblock %}
